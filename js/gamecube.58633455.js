"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[665],{651:function(e,t,a){a.d(t,{Z:function(){return u}});var r=function(){var e=this,t=e._self._c;return t("b-form-group",{scopedSlots:e._u([{key:"default",fn:function({ariaDescribedby:a}){return[t("b-form-radio-group",{staticClass:"radio-buttons",attrs:{options:e.options,"aria-describedby":a,buttons:"","button-variant":"outline-info"},model:{value:e.valueLocal,callback:function(t){e.valueLocal=t},expression:"valueLocal"}})]}}])})},i=[],n={name:"IndividualSavesOrMemoryCardSelector",props:{value:{type:String,default:null},individualSavesText:{type:String,default:"Individual saves"},memoryCardText:{type:String,default:"Memory card"}},model:{prop:"value",event:"change"},computed:{valueLocal:{get(){return this.value},set(e){this.$emit("change",e)}}},data(){return{options:[{value:"individual-saves",text:this.individualSavesText},{value:"memory-card",text:this.memoryCardText}]}}},s=n,o=a(1001),l=(0,o.Z)(s,r,i,!1,null,"725c0d84",null),u=l.exports},5796:function(e,t,a){a.d(t,{Z:function(){return m}});var r=function(){var e=this,t=e._self._c;return t("b-row",{attrs:{"no-gutters":"","align-h":"start","align-v":"center"}},[t("b-col",{attrs:{cols:"11",sm:"12"}},[t("div",[t("b-form-select",{attrs:{value:e.value,options:e.options},on:{input:function(t){return e.$emit("input",t)}}}),t("help-button",{staticClass:"help-button",attrs:{"popover-text":null!==this.overrideHelpText?this.overrideHelpText:"Some cartridges, flash carts, or emulators may not accept saves of a particular size for a particular game.           Try creating a test save with your cartridge, flash cart, or emulator to find what size it expects, then adjust the value here if necessary.",id:this.id}})],1)])],1)},i=[],n=a(2893),s=a(6428),o={name:"OutputFilesize",props:{value:{type:Number,default:null},id:{type:String,default:null},platform:{type:String,default:null},valuesToRemove:{type:Array,default:()=>[]},overrideHelpText:{type:String,default:null},customFormatter:{default:null}},components:{HelpButton:n.Z},methods:{getDropdownText(e){let t=null;switch(e){case 64:t="0.06";break;case 128:t="0.1";break;case 256:t="0.25";break;default:t=(e/1024).toFixed(e<1024?1:0);break}return`${t}kB (${e} bytes)`}},computed:{options(){if(null===this.platform)return[];const e=null!==this.customFormatter?this.customFormatter:this.getDropdownText,t=s.Z[this.platform].filter((e=>this.valuesToRemove.indexOf(e)<0));return[{value:null,text:"Output file size",disabled:!0}].concat(t.map((t=>({value:t,text:e(t)}))))}}},l=o,u=a(1001),c=(0,u.Z)(l,r,i,!1,null,"4a98b8ca",null),m=c.exports},2957:function(e,t,a){a.r(t),a.d(t,{default:function(){return wa}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertGameCube")],1)},i=[],n=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Raw/emulator")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{ref:"inputFileGameCubeSaveData",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.raw, *.gcp)",leaveRoomForHelpIcon:!1,acceptExtension:".raw,.gcp"},on:{load:function(t){return e.readGameCubeSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.gameCubeSaveDataLargest,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}}),t("output-filesize",{attrs:{value:this.outputFilesize,platform:"gamecube",customFormatter:e.formatSize,overrideHelpText:"Select the size of memory card that you wish to create"},on:{input:function(t){return e.changeOutputFilesize(t)}}}),t("game-cube-encoding-selector",{attrs:{value:this.outputEncoding,id:"gameCubeEncodingSelector"},on:{input:function(t){return e.changeOutputEncoding(t)}}}),t("input-file",{ref:"inputFileGameCubeExampleSaveData",attrs:{errorMessage:this.errorMessageExampleFile,placeholderText:"Optional: example file (*.raw, *.gcp)",leaveRoomForHelpIcon:!1,acceptExtension:".raw,.gcp",helpText:"When copying a .raw file to an original memory card, the file must contain a special ID number specific to that individual memory card.\n            Provide an example file here from that memory card so that the ID number can be copied from it. This is not required when using an emulator or the Memcard Pro GC.",id:"inputFileGameCubeExampleSaveData"},on:{load:function(t){return e.readGameCubeExampleFileSaveData(t)}}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq&&"individual-saves"===this.individualSavesOrMemoryCard?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.individualSavesOrMemoryCardText))]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",["individual-saves"===this.individualSavesOrMemoryCard?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1),t("individual-saves-or-memory-card-selector",{attrs:{value:this.individualSavesOrMemoryCard,individualSavesText:this.individualSavesText,memoryCardText:this.memoryCardText},on:{change:function(t){return e.changeIndividualSavesOrMemoryCard(t)}}}),"memory-card"===this.individualSavesOrMemoryCard?t("div",[t("output-filesize",{staticClass:"output-filesize",attrs:{value:this.outputFilesize,platform:"gamecube",customFormatter:e.formatSize,overrideHelpText:"Select the size of memory card that you wish to create"},on:{input:function(t){return e.changeOutputFilesize(t)}}})],1):e._e()],1):t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add (*.gci, *.gcs, *.sav)",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0,acceptExtension:".gci,.gcs,.sav"},on:{load:function(t){return e.readEmulatorSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.gameCubeSaveDataLargest,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"gamecube-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=gcn"}},[e._v("copy save files to and from a GameCube console")]),e._v("? ")],1)])],1)],1)],1)},s=[],o=a(3162),l=a(146),u=a(1203),c=a(3220),m=a(5796),d=a(1758),g=a(4507),v=a(651),h=function(){var e=this,t=e._self._c;return t("b-row",{attrs:{"no-gutters":"","align-h":"start","align-v":"center"}},[t("b-col",{attrs:{cols:"11",sm:"12"}},[t("div",[t("b-form-select",{attrs:{value:e.value,options:e.options},on:{input:function(t){return e.$emit("input",t)}}}),t("help-button",{staticClass:"help-button",attrs:{"popover-text":"Games from Japan and other Asian countries require a memory card created for Japan. All other games require it created for the Americas/Europe/Australia.\n          It is not possible to add saves for games from both regions to the same memory card.",id:this.id}})],1)])],1)},f=[],S=a(2893),p={name:"GameCubeEncodingSelector",props:{value:{type:String,default:null},asciiText:{type:String,default:"Americas/Europe/Australia"},shiftJisText:{type:String,default:"Japan/Korea"},id:{type:String,default:null}},components:{HelpButton:S.Z},model:{prop:"value",event:"change"},computed:{valueLocal:{get(){return this.value},set(e){this.$emit("change",e)}}},data(){return{options:[{value:"US-ASCII",text:this.asciiText},{value:"shift-jis",text:this.shiftJisText}]}}},b=p,C=a(1001),y=(0,C.Z)(b,h,f,!1,null,"335ade50",null),D=y.exports,F=(a(7658),a(6428)),E=a(6318);class w{}(0,E.Z)(w,"LITTLE_ENDIAN",!1),(0,E.Z)(w,"BLOCK_SIZE",8192),(0,E.Z)(w,"NUM_RESERVED_BLOCKS",5);const{BLOCK_SIZE:T,NUM_RESERVED_BLOCKS:L,LITTLE_ENDIAN:I}=w,x=new Map([["J","Japan"],["E","North America"],["P","Europe"],["D","Germany"],["F","France"],["H","Netherlands"],["I","Italy"],["S","Spain"],["K","Korea"],["U","Korea"],["W","Korea"]]),B="Unknown",k="X",A=new Map([[0,"US-ASCII"],[1,"shift-jis"]]),U="Unknown",_=-1,M=new Map([[0,"English"],[1,"German"],[2,"French"],[3,"Spanish"],[4,"Italian"],[5,"Dutch"]]),O="Unknown",Z=-1,z=9466848e5,N=162000000n,R=N/4n;function G(e,t,a){return t.has(e)?t.get(e):a}function $(e,t,a){const r=Array.from(t.keys()),i=r.find((a=>t.get(a)===e));return void 0===i?a:i}class V{static getRegionString(e){return G(e,x,B)}static getRegionCode(e){return $(e,x,k)}static getEncodingString(e){return G(e,A,U)}static getEncodingCode(e){return $(e,A,_)}static getLanguageString(e){return G(e,M,O)}static getLanguageCode(e){return $(e,M,Z)}static getDate(e){return new Date(1e3*e+z)}static getDateCode(e){return Math.floor((e.valueOf()-z)/1e3)}static getDateFromOsTime(e){const t=e/R;return V.getDate(Number(t))}static getOsTimeFromDate(e){const t=V.getDateCode(e);return BigInt(t)*R}static calculateChecksums(e,t,a){let r=0,i=0;const n=new DataView(e);for(let s=0;s<a;s+=2)r+=n.getUint16(t+s,I),i+=65535^n.getUint16(t+s,I),r&=65535,i&=65535;return 65535===r&&(r=0),65535===i&&(i=0),{checksum:r,checksumInverse:i}}static megabitsToBytes(e){return e/8*1024*1024}static bytesToMegabits(e){return e/1048576*8}static getTotalSizes(e){const t=V.megabitsToBytes(e);return{numTotalBytes:t,numTotalBlocks:t/T-L}}}a(3767),a(8585),a(8696);const{BLOCK_SIZE:H,LITTLE_ENDIAN:K}=w,P=255,q=0,j=12,J=12,W=20,Y=24,X=28,Q=32,ee=0,te=1,ae=34,re=36,ie=508,ne=510,se=0,oe=ie-se,le=l.Z.getFilledArrayBuffer(j,0);function ue(e,t){const a=new ArrayBuffer(j),r=new Uint8Array(a),i=new Uint8Array(e);let n=t;for(let s=0;s<j;s+=1)n=0x0000000041c64e6dn*n+0x0000000000003039n>>16n,r[s]=i[s]+Number(0xFFFFFFFFn&n)&255,n=0x0000000041c64e6dn*n+0x0000000000003039n>>16n,n&=0x0000000000007fffn;return a}function ce(e,t){const a=new ArrayBuffer(j),r=new Uint8Array(a),i=new Uint8Array(e);let n=t;for(let s=0;s<j;s+=1)n=0x0000000041c64e6dn*n+0x0000000000003039n>>16n,r[s]=i[s]-Number(0xFFn&n),n=0x0000000041c64e6dn*n+0x0000000000003039n>>16n,n&=0x0000000000007fffn;return a}class me{static writeHeader(e){let t=le;void 0!==e.cardFlashId&&(t=e.cardFlashId);const a=ue(t,e.formatOsTimeCode);let r=l.Z.getFilledArrayBuffer(H,P);r=l.Z.setArrayBufferPortion(r,a,q,0,j);const i=new DataView(r);i.setBigUint64(J,e.formatOsTimeCode,K),i.setUint32(W,e.rtcBias,K),i.setUint32(Y,e.languageCode,K),i.setUint32(X,e.viDtvStatus,K),i.setUint16(Q,e.memcardSlot,K),i.setUint16(ae,e.memcardSizeMegabits,K),i.setUint16(re,e.encodingCode,K);const{checksum:n,checksumInverse:s}=V.calculateChecksums(r,se,oe);return i.setUint16(ie,n,K),i.setUint16(ne,s,K),r}static readHeader(e){const t=new DataView(e),a=e.slice(q,q+j),r=t.getBigUint64(J,K),i=t.getUint32(W,K),n=t.getUint32(Y,K),s=t.getUint32(X,K),o=t.getUint16(Q,K),l=t.getUint16(ae,K),u=t.getUint16(re,K),c=t.getUint16(ie,K),m=t.getUint16(ne,K),d=ce(a,r),g=V.calculateChecksums(e,se,oe);if(c!==g.checksum)throw new Error(`File may be corrupt. Read checksum 0x${c.toString(16)} but calculated checksum 0x${g.checksum.toString(16)}`);if(m!==g.checksumInverse)throw new Error(`File may be corrupt. Read checksum inverse 0x${m.toString(16)} but calculated checksum inverse 0x${g.checksumInverse.toString(16)}`);return{serial:a,cardFlashId:d,formatOsTimeCode:r,formatTime:V.getDateFromOsTime(r),rtcBias:i,languageCode:n,language:V.getLanguageString(n),viDtvStatus:s,memcardSlot:o,memcardSizeMegabits:l,encodingCode:u,encodingString:V.getEncodingString(u)}}}(0,E.Z)(me,"MEMCARD_SLOT_A",ee),(0,E.Z)(me,"MEMCARD_SLOT_B",te);var de=a(1305);const{LITTLE_ENDIAN:ge}=w,ve="US-ASCII",he=0,fe=4,Se=3,pe=1,be=4,Ce=2,ye=7,De=8,Fe=32,Ee=40,we=44,Te=48,Le=50,Ie=52,xe=53,Be=54,ke=56,Ae=60,Ue=32,_e=64,Me=255,Oe=0;class Ze{static writeDirectoryEntry(e){let t=l.Z.getFilledArrayBuffer(_e,Me);t=l.Z.fillArrayBufferPortion(t,De,Fe,Oe),t=l.Z.setString(t,he,e.gameCode,ve,fe),t=l.Z.setString(t,be,e.publisherCode,ve,Ce),t=l.Z.setString(t,De,e.fileName,ve,Fe);const a=new DataView(t);return a.setUint8(ye,e.bannerAndIconFlags),a.setUint32(Ee,e.dateLastModifiedCode,ge),a.setUint32(we,e.iconStartOffset,ge),a.setUint16(Te,e.iconFormatCode,ge),a.setUint16(Le,e.iconSpeedCode,ge),a.setUint8(Ie,e.permissionAttributeBitfield),a.setUint8(xe,e.copyCounter),a.setUint16(Be,e.saveStartBlock,ge),a.setUint16(ke,e.saveSizeBlocks,ge),a.setUint32(Ae,e.commentStart,ge),t}static getComments(e,t,a){const r=new Uint8Array(t),i=[e,e+Ue];return i.map((e=>l.Z.readNullTerminatedString(r,e,a,Ue)))}static readDirectoryEntry(e){const t=new Uint8Array(e),a=new DataView(e),r=t.slice(he,he+fe).some((e=>255!==e));if(!r)return null;const i=l.Z.readString(t,he,ve,fe),n=l.Z.readString(t,Se,ve,pe),s=l.Z.readString(t,be,ve,Ce),o=a.getUint8(ye),u=l.Z.readNullTerminatedString(t,De,ve,Fe),c=a.getUint32(Ee,ge),m=a.getUint32(we,ge),d=a.getUint16(Te,ge),g=a.getUint16(Le,ge),v=a.getUint8(Ie),h=a.getUint8(xe),f=a.getUint16(Be,ge),S=a.getUint16(ke,ge),p=a.getUint32(Ae,ge);return{gameCode:i,regionCode:n,region:V.getRegionString(n),publisherCode:s,bannerAndIconFlags:o,fileName:u,dateLastModifiedCode:c,dateLastModified:V.getDate(c),iconStartOffset:m,iconFormatCode:d,iconSpeedCode:g,permissionAttributeBitfield:v,copyCounter:h,saveStartBlock:f,saveSizeBlocks:S,commentStart:p}}}(0,E.Z)(Ze,"ICON_SPEED_NONE",0),(0,E.Z)(Ze,"ICON_SPEED_FAST",1),(0,E.Z)(Ze,"ICON_SPEED_MIDDLE",2),(0,E.Z)(Ze,"ICON_SPEED_SLOW",3),(0,E.Z)(Ze,"PERMISSION_ATTRIBUTE_PUBLIC",4),(0,E.Z)(Ze,"PERMISSION_ATTRIBUTE_NO_COPY",8),(0,E.Z)(Ze,"PERMISSION_ATTRIBUTE_NO_MOVE",16),(0,E.Z)(Ze,"LENGTH",_e);const{LITTLE_ENDIAN:ze,BLOCK_SIZE:Ne}=w,Re=255,Ge=127,$e=Ze.LENGTH,Ve=0,He=8186,Ke=8188,Pe=8190,qe=0,je=Ke-qe;class Je{static writeDirectory(e){if(e.length>Ge)throw new Error(`Unable to fit ${e.length} saves into a single memory card image. Max is ${Ge}`);let t=l.Z.getFilledArrayBuffer(Ne,Re);e.forEach(((e,a)=>{const r=Ze.writeDirectoryEntry(e);t=l.Z.setArrayBufferPortion(t,r,a*Ze.LENGTH,0,Ze.LENGTH)}));const a=new DataView(t);a.setInt16(He,Ve,ze);const{checksum:r,checksumInverse:i}=V.calculateChecksums(t,qe,je);return a.setUint16(Ke,r,ze),a.setUint16(Pe,i,ze),t}static readDirectory(e){const t=new DataView(e),a=t.getInt16(He,ze),r=t.getUint16(Ke,ze),i=t.getUint16(Pe,ze),n=de.Z.createSequentialArray(0,Ge).map((t=>{const a=e.slice(t*$e,(t+1)*$e);return Ze.readDirectoryEntry(a)})).filter((e=>null!==e)),s=V.calculateChecksums(e,qe,je);return r!==s.checksum||i!==s.checksumInverse?null:{directoryEntries:n,updateCounter:a}}}const{LITTLE_ENDIAN:We,BLOCK_SIZE:Ye,NUM_RESERVED_BLOCKS:Xe}=w,Qe=4091,et=2,tt=0,at=0,rt=2,it=4,nt=6,st=8,ot=10,lt=it,ut=Ye-lt,ct=0,mt=65535;class dt{static writeBlockAllocationTable(e,t){const a=l.Z.getFilledArrayBuffer(Ye,ct),r=new DataView(a);let i=0;const n=e.map((e=>{const t=e.blockList.map(((e,t)=>Xe+i+t+1));return i+=e.blockList.length,t.length>0&&(t.pop(),t.push(mt)),t})),s=n.reduce(((e,t)=>e+t.length),0);if(s>Qe)throw new Error(`Cannot fit all save files in memory card image. Desired block allocation table size: ${s} entries, but max is ${Qe}`);let o=ot;n.forEach((e=>{e.forEach((e=>{r.setUint16(o,e,We),o+=et}))})),r.setUint16(nt,t-i,We),r.setUint16(st,i-1+Xe,We),r.setInt16(it,tt,We);const{checksum:u,checksumInverse:c}=V.calculateChecksums(a,lt,ut);return r.setUint16(at,u,We),r.setUint16(rt,c,We),a}static readBlockAllocationTable(e){const t=new DataView(e),a=t.getUint16(at,We),r=t.getUint16(rt,We),i=t.getInt16(it,We),n=t.getUint16(nt,We),s=t.getUint16(st,We),o=de.Z.createSequentialArray(0,Qe).map((e=>t.getUint16(ot+e*et,We))),l=V.calculateChecksums(e,lt,ut);return a!==l.checksum||r!==l.checksumInverse?null:{updateCounter:i,numFreeBlocks:n,lastAllocatedBlock:s,blockAllocationTable:o}}}(0,E.Z)(dt,"TABLE_ENTRY_BLOCK_IS_FREE",ct),(0,E.Z)(dt,"TABLE_ENTRY_LAST_BLOCK",mt);const{BLOCK_SIZE:gt,LITTLE_ENDIAN:vt}=w,ht=0,ft=2;class St{static fixupSaveFile(e,t){if("f_zero.dat"!==e.fileName)return e;if(4!==Math.ceil(e.rawData.byteLength/gt))return e;const a={...e,rawData:l.Z.copyArrayBuffer(e.rawData)},r=new DataView(a.rawData),i=new Uint8Array(a.rawData);r.setUint16(1*gt+102,t.serial1>>>16&65535,vt),r.setUint16(3*gt+5504,t.serial2>>>16&65535,vt),r.setUint16(1*gt+96,65535&t.serial1,vt),r.setUint16(1*gt+512,65535&t.serial2,vt);let n=65535;for(let s=ht+ft;s<a.rawData.byteLength;s+=1){n^=i[s];for(let e=8;e>0;e-=1)0!==(1&n)?n=(n>>>1^33800)>>>0:n>>>=1}return r.setUint16(ht,65535&~n,vt),a}}const{BLOCK_SIZE:pt,LITTLE_ENDIAN:bt}=w,Ct=new Map([["PSO_SYSTEM",0],["PSO3_SYSTEM",16]]),yt=256,Dt=new Array(yt);function Ft(){let e=0;for(let t=0;t<yt;t+=1){e=t;for(let t=8;t>0;t-=1)0!==(1&e)?e=(e>>>1^3988292384)>>>0:e>>>=1;Dt[t]=e}}Ft();class Et{static fixupSaveFile(e,t){if(!Ct.has(e.fileName))return e;const a={...e,rawData:l.Z.copyArrayBuffer(e.rawData)},r=new DataView(a.rawData),i=new Uint8Array(a.rawData);r.setUint32(1*pt+344,t.serial1,bt),r.setUint32(1*pt+348,t.serial2,bt);const n=Ct.get(a.fileName);let s=3736805603;for(let o=76;o<356+n;o+=1){const e=((s^i[1*pt+o])>>>0)%yt;s=(s>>>8&16777215^Dt[e])>>>0}return r.setUint32(1*pt+72,(4294967295^s)>>>0,bt),a}}const{LITTLE_ENDIAN:wt}=w,Tt=[St,Et],Lt=32;function It(e){const t=new DataView(e);let a=0,r=0;for(let i=0;i<Lt;i+=8)a=4294967295&(a^t.getUint32(i+0,wt)),r=4294967295&(r^t.getUint32(i+4,wt));return{serial1:a,serial2:r}}class xt{static fixupSaveFile(e,t){const a=It(t);let r=e;return Tt.forEach((e=>{r=e.fixupSaveFile(r,a)})),r}}const{BLOCK_SIZE:Bt,NUM_RESERVED_BLOCKS:kt}=w,At=0,Ut=1,_t=2,Mt=3,Ot=4,Zt=0;function zt(e,t){const a=t*Bt;return e.slice(a,a+Bt)}function Nt(e){return l.Z.getFilledArrayBuffer(Bt*e,Zt)}function Rt(e,t){if(null!==e&&null!==t)return t.updateCounter>e.updateCounter?t:e;if(null!==t)return t;if(null!==e)return e;throw new Error("This memory card image appears to be corrupted")}function Gt(e,t){let a=e;const r=[];do{const e=a,i=t[e-kt];if(i===dt.TABLE_ENTRY_BLOCK_IS_FREE)throw new Error("File appears to be corrupted: block list for file contains entry marked as free");r.push(e),a=i}while(a!==dt.TABLE_ENTRY_LAST_BLOCK);return r}function $t(e,t,a){const r=Gt(e,t),i=r.map((e=>zt(a,e)));return{blockNumberList:r,rawData:l.Z.concatArrayBuffers(i)}}function Vt(e,t,a,r){return e.map((e=>{const i=$t(e.saveStartBlock,t,a),n=Ze.getComments(e.commentStart,i.rawData,r);return{...e,comments:n,...i}}))}function Ht(e){if(!F.Z.gamecube.includes(e))throw new Error(`${e} bytes (${V.bytesToMegabits(e)} megabits) is not a valid size for a gamecube memory card image`)}class Kt{static createWithNewSize(e,t){Ht(t);const a={...e.getVolumeInfo(),memcardSizeMegabits:V.bytesToMegabits(t)};return Kt.createFromSaveFiles(e.getSaveFiles(),a)}static createWithNewEncoding(e,t){const a={...e.getVolumeInfo(),encodingCode:V.getEncodingCode(t)};return Kt.createFromSaveFiles(e.getSaveFiles(),a)}static createFromGameCubeData(e){if(e.byteLength<kt*Bt)throw new Error("This does not appear to be a GameCube memory card image");const t=me.readHeader(zt(e,At)),{numTotalBytes:a,numTotalBlocks:r}=V.getTotalSizes(t.memcardSizeMegabits);if(e.byteLength<a)throw new Error("This does not appear to be a GameCube memory card image");const i=Rt(Je.readDirectory(zt(e,Ut)),Je.readDirectory(zt(e,_t))),n=Rt(dt.readBlockAllocationTable(zt(e,Mt)),dt.readBlockAllocationTable(zt(e,Ot))),s={...t,numTotalBlocks:r,numUsedBlocks:r-n.numFreeBlocks,numFreeBlocks:n.numFreeBlocks,lastAllocatedBlock:n.lastAllocatedBlock},o=Vt(i.directoryEntries,n.blockAllocationTable,e,t.encodingString);return new Kt(e,o,s)}static createFromSaveFiles(e,t){const{numTotalBytes:a,numTotalBlocks:r}=V.getTotalSizes(t.memcardSizeMegabits);Ht(a);const i=me.writeHeader(t),n=e.map((e=>xt.fixupSaveFile(e,i)));let s=kt;const o=n.map((e=>{const t=s,a=[];for(let r=0;r<e.rawData.byteLength;r+=Bt)a.push(e.rawData.slice(r,r+Bt));if(a.length>0){let e=a.pop();e=l.Z.padArrayBuffer(e,Bt,Zt),a.push(e)}return s+=a.length,{...e,saveStartBlock:t,saveSizeBlocks:a.length,blockList:a}})),u=Je.writeDirectory(o),c=dt.writeBlockAllocationTable(o,r);let m=l.Z.concatArrayBuffers([i,u,u,c,c]);if(o.forEach((e=>{m=l.Z.concatArrayBuffers([m,...e.blockList])})),m.byteLength>a)throw new Error(`Unable to create a ${t.memcardSizeMegabit} megabit card for these save files. Requires ${m.byteLength} bytes but card is only ${a} bytes`);const d=Math.floor((a-m.byteLength)/Bt);return m=l.Z.concatArrayBuffers([m,Nt(d)]),new Kt(m,o,t)}constructor(e,t,a){this.arrayBuffer=e,this.saveFiles=t,this.volumeInfo=a}getSaveFiles(){return this.saveFiles}getVolumeInfo(){return this.volumeInfo}getArrayBuffer(){return this.arrayBuffer}}const{BLOCK_SIZE:Pt}=w,qt="US-ASCII",jt=["Japan","Korea"],Jt=Ze.LENGTH,Wt=0;class Yt{static convertSaveFilesToGcis(e){return e.map((e=>{const t={...e,saveStartBlock:Wt,saveSizeBlocks:e.rawData.byteLength/Pt},a=Ze.writeDirectoryEntry(t);return l.Z.concatArrayBuffers([a,t.rawData])}))}static convertIndividualSaveToSaveFile(e,t=!0){const a=Ze.readDirectoryEntry(e,qt),r=e.slice(Jt),i=jt.indexOf(a.region)>=0?"shift-jis":"US-ASCII";if(t&&r.byteLength!==a.saveSizeBlocks*Pt)throw new Error(`File appears to be corrupt. Save size specified as ${a.saveSizeBlocks} blocks (${a.saveSizeBlocks*Pt} bytes) but save data is ${r.byteLength} bytes`);const n=Ze.getComments(a.commentStart,r,i);return{...a,inferredCommentEncoding:i,comments:n,rawData:r}}}const{BLOCK_SIZE:Xt}=w,Qt=272,ea="GCSAVE",ta=0,aa="US-ASCII",ra=16,ia=Qt-ra;class na{static convertIndividualSaveToSaveFile(e){l.Z.checkMagic(e,ta,ea,aa);const t=new Uint8Array(e),a=e.slice(Qt),r=Yt.convertIndividualSaveToSaveFile(a,!1),i=l.Z.readNullTerminatedString(t,ra,r.inferredCommentEncoding,ia);return{...r,saveSizeBlocks:Math.ceil(r.rawData.byteLength/Xt),gameSharkComment:i}}}const sa=128,oa="DATELGC_SAVE",la=0,ua="US-ASCII",ca=[16,72],ma=56,da=[6,44,46,48,50,52,54,56,58,60,62];class ga{static convertIndividualSaveToSaveFile(e){l.Z.checkMagic(e,la,oa,ua);const t=new Uint8Array(e),a=e.slice(sa),r=new DataView(a);da.forEach((e=>r.setUint16(e,r.getUint16(e,!1),!0)));const i=Yt.convertIndividualSaveToSaveFile(a),n=ca.map((e=>l.Z.readNullTerminatedString(t,e,i.inferredCommentEncoding,ma)));return{...i,maxDriveComments:n}}}const va=[na,ga,Yt];class ha{static convertIndividualSaveToSaveFile(e){for(let a=0;a<va.length;a+=1)try{return va[a].convertIndividualSaveToSaveFile(e)}catch(t){}throw new Error("This does not appear to be a GameCube individual save file")}}const fa=2097152,Sa="US-ASCII";var pa={name:"ConvertGameCube",data(){return{gameCubeSaveDataLargest:null,gameCubeSaveDataResized:null,gameCubeSaveDataExample:null,errorMessage:null,errorMessageExampleFile:null,inputFilename:null,outputFilename:null,outputFilesize:fa,outputEncoding:Sa,conversionDirection:"convertToRaw",selectedSaveData:null,individualSavesOrMemoryCard:"individual-saves",individualSavesText:"Individual saves",memoryCardText:"Raw/emulator"}},components:{ConversionDirection:d.Z,InputFile:u.Z,OutputFilename:c.Z,OutputFilesize:m.Z,FileList:g.Z,IndividualSavesOrMemoryCardSelector:v.Z,GameCubeEncodingSelector:D},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData,t="individual-saves"===this.individualSavesOrMemoryCard?this.gameCubeSaveDataLargest:this.gameCubeSaveDataResized;return!t||0===t.getSaveFiles().length||!e||!this.outputFilename},individualSavesOrMemoryCardText(){return"individual-saves"===this.individualSavesOrMemoryCard?this.individualSavesText:this.memoryCardText},largestSaveSize(){return F.Z.gamecube.at(-1)}},methods:{formatSize(e){const t=V.bytesToMegabits(e),{numTotalBlocks:a}=V.getTotalSizes(t);return`${a} blocks (${t} megabits)`},getFileNameFromSaveFile(e){const t=l.Z.convertDescriptionToFilename(`${e.publisherCode}-${e.gameCode}-${e.fileName}`);return`${t}.gci`},getFileSizeErrorMessage(){const e=V.bytesToMegabits(this.outputFilesize),{numTotalBlocks:t}=V.getTotalSizes(e);return`A GameCube memory card of size ${t} blocks (${e} megabits) is not large enough to contain all of the files specified`},getGameCubeDataResized(){if(this.gameCubeSaveDataResized=null,null!==this.gameCubeSaveDataLargest)try{this.gameCubeSaveDataResized=Kt.createWithNewSize(this.gameCubeSaveDataLargest,this.outputFilesize)}catch(e){this.errorMessage=this.getFileSizeErrorMessage(),this.gameCubeSaveDataResized=null,this.selectedSaveData=null}},changeOutputFilesize(e){this.outputFilesize=e,this.errorMessage=null,this.getGameCubeDataResized()},changeOutputEncoding(e){if(this.outputEncoding=e,this.errorMessage=null,null!==this.gameCubeSaveDataLargest)try{this.gameCubeSaveDataLargest=Kt.createWithNewEncoding(this.gameCubeSaveDataLargest,this.outputEncoding)}catch(t){this.errorMessage="Could not create save file for this region",this.gameCubeSaveDataLargest=null,this.selectedSaveData=null}this.getGameCubeDataResized()},changeIndividualSavesOrMemoryCard(e){this.errorMessage=null,this.individualSavesOrMemoryCard!==e&&(this.individualSavesOrMemoryCard=e,"individual-saves"===e?null===this.selectedSaveData&&this.changeSelectedSaveData(0):(null!==this.inputFilename&&(this.outputFilename=l.Z.changeFilenameExtension(this.inputFilename,"raw")),this.selectedSaveData=null,this.getGameCubeDataResized()))},getFileListNames(){return null!==this.gameCubeSaveDataLargest&&null!==this.gameCubeSaveDataLargest.getSaveFiles()?this.gameCubeSaveDataLargest.getSaveFiles().map((e=>({displayText:`${e.comments[0]} - ${e.comments[1]}`}))):[]},changeConversionDirection(e){this.conversionDirection=e,this.gameCubeSaveDataLargest=null,this.gameCubeSaveDataResized=null,this.gameCubeSaveDataExample=null,this.errorMessage=null,this.errorMessageExampleFile=null,this.inputFilename=null,this.outputFilename=null,this.outputFilesize=fa,this.outputEncoding=Sa,this.selectedSaveData=null,this.individualSavesOrMemoryCard="individual-saves",this.$refs.inputFileGameCubeSaveData&&this.$refs.inputFileGameCubeSaveData.reset(),this.$refs.inputFileGameCubeExampleSaveData&&this.$refs.inputFileGameCubeExampleSaveData.reset()},changeSelectedSaveData(e){null!==e&&(null!==this.gameCubeSaveDataLargest&&this.gameCubeSaveDataLargest.getSaveFiles().length>0?(this.selectedSaveData=e,this.outputFilename=this.getFileNameFromSaveFile(this.gameCubeSaveDataLargest.getSaveFiles()[this.selectedSaveData]),this.changeIndividualSavesOrMemoryCard("individual-saves")):(this.selectedSaveData=null,this.outputFilename=null))},readGameCubeExampleFileSaveData(e){this.errorMessageExampleFile=null;try{this.gameCubeSaveDataExample=Kt.createFromGameCubeData(e.arrayBuffer),this.changeOutputFilesize(this.gameCubeSaveDataExample.getArrayBuffer().byteLength)}catch(t){this.errorMessageExampleFile="File appears to not be in the correct format",this.gameCubeSaveDataExample=null}},readGameCubeSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=e.filename;try{this.gameCubeSaveDataLargest=Kt.createFromGameCubeData(e.arrayBuffer),this.individualSavesOrMemoryCard=null,this.changeIndividualSavesOrMemoryCard("individual-saves"),this.changeOutputFilesize(this.gameCubeSaveDataLargest.getArrayBuffer().byteLength),this.getGameCubeDataResized()}catch(t){this.errorMessage="File appears to not be in the correct format",this.gameCubeSaveDataLargest=null,this.gameCubeSaveDataResized=null,this.selectedSaveData=null}},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=null;try{const t=e.map((e=>e.arrayBuffer)),a=t.map((e=>ha.convertIndividualSaveToSaveFile(e))),r={formatOsTimeCode:V.getOsTimeFromDate(new Date),rtcBias:0,languageCode:V.getLanguageCode("English"),viDtvStatus:0,memcardSlot:me.MEMCARD_SLOT_A,memcardSizeMegabits:V.bytesToMegabits(this.largestSaveSize),encodingCode:V.getEncodingCode(this.outputEncoding)};this.gameCubeSaveDataLargest=Kt.createFromSaveFiles(a,r),this.gameCubeSaveDataLargest.getSaveFiles().length>0?this.outputFilename=`${l.Z.removeFilenameExtension(this.getFileNameFromSaveFile(this.gameCubeSaveDataLargest.getSaveFiles()[0]))}.raw`:this.outputFilename="output.raw",this.getGameCubeDataResized()}catch(t){this.errorMessage=t.message,this.gameCubeSaveDataLargest=null,this.selectedSaveData=null}},convertFile(){let e=null;if("convertToRaw"===this.conversionDirection&&"individual-saves"===this.individualSavesOrMemoryCard){const t=Yt.convertSaveFilesToGcis(this.gameCubeSaveDataLargest.getSaveFiles());e=t[this.selectedSaveData]}else{if(null!==this.gameCubeSaveDataExample){const e={...this.gameCubeSaveDataLargest.getVolumeInfo(),cardFlashId:this.gameCubeSaveDataExample.getVolumeInfo().cardFlashId};this.gameCubeSaveDataLargest=Kt.createFromSaveFiles(this.gameCubeSaveDataLargest.getSaveFiles(),e),this.getGameCubeDataResized()}e=this.gameCubeSaveDataResized.getArrayBuffer()}const t=new Blob([e],{type:"application/octet-stream"});(0,o.saveAs)(t,this.outputFilename)}}},ba=pa,Ca=(0,C.Z)(ba,n,s,!1,null,"58f0de9c",null),ya=Ca.exports,Da={name:"GameCubeView",components:{ConvertGameCube:ya}},Fa=Da,Ea=(0,C.Z)(Fa,r,i,!1,null,null,null),wa=Ea.exports},6428:function(e,t,a){a(7658);const r={nes:[512,1024,2048,4096,8192,16384,32768,65536,131072],snes:[512,1024,2048,4096,8192,16384,32768,65536,131072],n64:[512,2048,32768,131072,786432],gb:[512,1024,2048,4096,8192,16384,32768,65536],gba:[512,8192,32768,65536,131072],gamegear:[512,1024,2048,4096,8192,16384,32768,65536],sms:[512,1024,2048,4096,8192,16384,32768,65536],genesis:[64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072],segacd:[8192,16384,32768,65536,131072,262144,524288],gamecube:[524288,1048576,2097152,4194304,8388608,16777216]},i=["segacd","gamecube"],n=Object.keys(r).filter((e=>!i.includes(e))),s=n.reduce(((e,t)=>(e.push(...r[t]),e)),[]),o=[...new Set(s)].sort(((e,t)=>e-t));r.all=o,t["Z"]=r},1305:function(e,t,a){a.d(t,{Z:function(){return r}});class r{static arraysEqual(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a+=1)if(e[a]!==t[a])return!1;return!0}static createSequentialArray(e,t){return Array(t).fill().map(((t,a)=>a+e))}static createReverseSequentialArray(e,t){return r.createSequentialArray(e-t+1,t).reverse()}}},6318:function(e,t,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function n(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)}function s(e,t,a){return t=n(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return s}})}}]);