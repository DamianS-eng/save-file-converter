"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[119],{651:function(e,t,a){a.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("b-form-group",{scopedSlots:e._u([{key:"default",fn:function({ariaDescribedby:a}){return[t("b-form-radio-group",{staticClass:"radio-buttons",attrs:{options:e.options,"aria-describedby":a,buttons:"","button-variant":"outline-info"},model:{value:e.valueLocal,callback:function(t){e.valueLocal=t},expression:"valueLocal"}})]}}])})},i=[],n={name:"IndividualSavesOrMemoryCardSelector",props:{value:{type:String,default:null},individualSavesText:{type:String,default:"Individual saves"},memoryCardText:{type:String,default:"Memory card"}},model:{prop:"value",event:"change"},computed:{valueLocal:{get(){return this.value},set(e){this.$emit("change",e)}}},data(){return{options:[{value:"individual-saves",text:this.individualSavesText},{value:"memory-card",text:this.memoryCardText}]}}},s=n,o=a(1001),l=(0,o.Z)(s,r,i,!1,null,"725c0d84",null),c=l.exports},5334:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertPs1DexDrive")],1)},i=[],n=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("DexDrive")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.gme)",acceptExtension:".gme",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readDexDriveSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.dexDriveSaveData,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq&&"individual-saves"===this.individualSavesOrMemoryCard?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.individualSavesOrMemoryCardText))]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",["individual-saves"===this.individualSavesOrMemoryCard?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!0,helpText:"The filename for an individual save contains important information that the game needs to find this save data. Please do not modify it after downloading the save."},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1),t("individual-saves-or-memory-card-selector",{attrs:{value:this.individualSavesOrMemoryCard,individualSavesText:this.individualSavesText,memoryCardText:this.memoryCardText},on:{change:function(t){return e.changeIndividualSavesOrMemoryCard(t)}}})],1):t("div",["individual-saves"===this.individualSavesOrMemoryCard?t("div",[t("input-file",{ref:"inputFileEmulator",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0},on:{load:function(t){return e.readEmulatorSaveData(t)}}})],1):t("div",[t("input-file",{ref:"inputFileEmulatorMemcard",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.mcr)",acceptExtension:".mcr",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readEmulatorMemcardSaveData(t)}}})],1),t("individual-saves-or-memory-card-selector",{attrs:{value:this.individualSavesOrMemoryCard,individualSavesText:this.individualSavesText,memoryCardText:this.memoryCardText},on:{change:function(t){return e.changeIndividualSavesOrMemoryCard(t)}}}),t("file-list",{attrs:{display:null!==this.dexDriveSaveData,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"ps1-dexdrive-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=ps1"}},[e._v("copy save files to and from a PS1 memory card")]),e._v("? ")],1),t("div",{staticClass:"help"},[e._v(" Help: how do IÂ "),t("b-link",{attrs:{href:"https://github.com/ShendoXT/memcardrex/releases"}},[e._v("copy files to and from my DexDrive")]),e._v("? ")],1)])],1)],1)],1)},s=[],o=a(3162),l=a(146),c=a(1203),u=a(3220),d=a(1758),v=a(4507),m=a(651),h=(a(7658),a(3767),a(8585),a(8696),a(6393)),f=a(0),D=a(8250);const{NUM_DATA_BLOCKS:S,TOTAL_SIZE:p,LITTLE_ENDIAN:g}=D["default"],y=3904,F="123-456-STD",C="US-ASCII",x=22,b=38,w="utf8",M=64,_=256;function T(e){return M+e*_}function E(e){const t=[],a=new TextDecoder(w);for(let r=0;r<S;r+=1){const i=T(r),n=e.slice(i,i+_);t.push(l.Z.trimNull(a.decode(n)).trim())}return t}class A{static createFromDexDriveData(e){return new A(e)}static createFromMemoryCardData(e,t){const a=h.Z.createFromPs1MemcardData(e),r=a.getSaveFiles().map((e=>({...e,comment:t})));return A.createFromSaveFiles(r)}static createFromSaveFiles(e){const t=h.Z.createFromSaveFiles(e),a=new ArrayBuffer(y),r=new Uint8Array(a),i=new TextEncoder(C),n=new TextEncoder(w),s=Array.from({length:S},(()=>null)),o=t.getSaveFiles().map(((t,a)=>({...t,comment:e[a].comment})));o.forEach((e=>{s[e.startingBlock]=e.comment})),r.fill(0),r.set(i.encode(F),0),r[18]=1,r[20]=1,r[21]=77;for(let l=0;l<S;l+=1){const e=t.getDirectoryFrame(l),a=new DataView(e),i=a.getUint8(f.Z.DIRECTORY_FRAME_AVAILABLE_OFFSET),o=a.getUint16(f.Z.DIRECTORY_FRAME_NEXT_BLOCK_OFFSET,g);if(r[x+l]=i,r[b+l]=o,null!==s[l]){const e=n.encode(s[l]).slice(0,_);r.set(e,T(l))}}const c=l.Z.concatArrayBuffers([a,t.getArrayBuffer()]);return A.createFromDexDriveData(c)}constructor(e){this.arrayBuffer=e;let t=e.slice(0,y),a=e.slice(y);try{l.Z.checkMagic(t,0,F,C)}catch(i){if(e.byteLength===p)t=l.Z.getFilledArrayBuffer(y,0),a=e;else if(e.byteLength!==y+p)throw new Error("This does not appear to be a PS1 DexDrive file")}const r=E(t);this.memoryCard=h.Z.createFromPs1MemcardData(a),this.saveFiles=this.memoryCard.getSaveFiles().map((e=>({...e,comment:r[e.startingBlock]})))}getSaveFiles(){return this.saveFiles}getMemoryCard(){return this.memoryCard}getArrayBuffer(){return this.arrayBuffer}}var O={name:"ConvertPs1DexDrive",data(){return{dexDriveSaveData:null,errorMessage:null,inputFilename:null,outputFilename:null,conversionDirection:"convertToRaw",selectedSaveData:null,individualSavesOrMemoryCard:"memory-card",individualSavesText:"Individual saves",memoryCardText:"Raw/emulator"}},components:{ConversionDirection:d.Z,InputFile:c.Z,OutputFilename:u.Z,FileList:v.Z,IndividualSavesOrMemoryCardSelector:m.Z},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData;return!this.dexDriveSaveData||0===this.dexDriveSaveData.getSaveFiles().length||!e||!this.outputFilename},individualSavesOrMemoryCardText(){return"individual-saves"===this.individualSavesOrMemoryCard?this.individualSavesText:this.memoryCardText}},methods:{changeIndividualSavesOrMemoryCard(e){this.individualSavesOrMemoryCard!==e&&(this.individualSavesOrMemoryCard=e,"convertToFormat"===this.conversionDirection?(this.selectedSaveData=null,this.dexDriveSaveData=null,this.outputFilename=null,this.$refs.inputFileEmulator&&this.$refs.inputFileEmulator.reset(),this.$refs.inputFileEmulatorMemcard&&this.$refs.inputFileEmulatorMemcard.reset()):"individual-saves"===e?null===this.selectedSaveData&&this.changeSelectedSaveData(0):(null!==this.inputFilename&&(this.outputFilename=l.Z.changeFilenameExtension(this.inputFilename,"mcr")),this.selectedSaveData=null))},getFileListNames(){return null!==this.dexDriveSaveData&&null!==this.dexDriveSaveData.getSaveFiles()?this.dexDriveSaveData.getSaveFiles().map((e=>({displayText:`${e.description} (${e.regionName})`}))):null},changeConversionDirection(e){this.conversionDirection=e,this.dexDriveSaveData=null,this.errorMessage=null,this.inputFilename=null,this.outputFilename=null,this.selectedSaveData=null,this.individualSavesOrMemoryCard="memory-card"},changeSelectedSaveData(e){null!==e&&(null!==this.dexDriveSaveData&&this.dexDriveSaveData.getSaveFiles().length>0?(this.selectedSaveData=e,this.outputFilename=this.dexDriveSaveData.getSaveFiles()[this.selectedSaveData].filename,this.changeIndividualSavesOrMemoryCard("individual-saves")):(this.selectedSaveData=null,this.outputFilename=null))},readDexDriveSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=e.filename;try{this.dexDriveSaveData=A.createFromDexDriveData(e.arrayBuffer),this.individualSavesOrMemoryCard=null,this.changeIndividualSavesOrMemoryCard("memory-card")}catch(t){this.errorMessage="File appears to not be in the correct format",this.dexDriveSaveData=null,this.selectedSaveData=null}},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=null;try{const t=e.map((e=>({filename:e.filename,rawData:e.arrayBuffer,comment:"Created with savefileconverter.com"})));this.dexDriveSaveData=A.createFromSaveFiles(t),this.dexDriveSaveData.getSaveFiles().length>0?this.outputFilename=`${l.Z.convertDescriptionToFilename(this.dexDriveSaveData.getSaveFiles()[0].description)}.gme`:this.outputFilename="output.gme"}catch(t){this.errorMessage=t.message,this.dexDriveSaveData=null,this.selectedSaveData=null}},readEmulatorMemcardSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=e.filename,this.outputFilename=l.Z.changeFilenameExtension(e.filename,"gme");try{this.dexDriveSaveData=A.createFromMemoryCardData(e.arrayBuffer,"Created with savefileconverter.com"),this.changeIndividualSavesOrMemoryCard("memory-card")}catch(t){this.errorMessage="File appears to not be in the correct format",this.dexDriveSaveData=null,this.selectedSaveData=null}},convertFile(){let e=null;e="convertToRaw"===this.conversionDirection?"individual-saves"===this.individualSavesOrMemoryCard?this.dexDriveSaveData.getSaveFiles()[this.selectedSaveData].rawData:this.dexDriveSaveData.getMemoryCard().getArrayBuffer():this.dexDriveSaveData.getArrayBuffer();const t=new Blob([e],{type:"application/octet-stream"});(0,o.saveAs)(t,this.outputFilename)}}},B=O,Z=a(1001),L=(0,Z.Z)(B,n,s,!1,null,"3a77c970",null),I=L.exports,U={name:"Ps1DexDriveView",components:{ConvertPs1DexDrive:I}},k=U,N=(0,Z.Z)(k,r,i,!1,null,null,null),R=N.exports},8250:function(e,t,a){a.d(t,{default:function(){return i}});var r=a(6318);class i{}(0,r.Z)(i,"NUM_RESERVED_BLOCKS",1),(0,r.Z)(i,"NUM_DATA_BLOCKS",15),(0,r.Z)(i,"NUM_TOTAL_BLOCKS",i.NUM_RESERVED_BLOCKS+i.NUM_DATA_BLOCKS),(0,r.Z)(i,"BLOCK_SIZE",8192),(0,r.Z)(i,"FRAME_SIZE",128),(0,r.Z)(i,"TOTAL_SIZE",i.NUM_TOTAL_BLOCKS*i.BLOCK_SIZE),(0,r.Z)(i,"LITTLE_ENDIAN",!0),(0,r.Z)(i,"MAGIC_ENCODING","US-ASCII")},0:function(e,t,a){a.d(t,{Z:function(){return I}});var r=a(6318),i=(a(3767),a(8585),a(8696),a(7658),a(8250)),n=a(146);const{LITTLE_ENDIAN:s,BLOCK_SIZE:o,NUM_DATA_BLOCKS:l,NUM_TOTAL_BLOCKS:c,FRAME_SIZE:u,MAGIC_ENCODING:d}=i["default"],v="MC",m=0,h=0,f=8,D=65535,S=10,p=20,g="US-ASCII",y=4,F=160,C=81,x=82,b=83,w=255;function M(e,t){const a=u+t*u;return e.slice(a,a+u)}function _(e){const t=new Uint8Array(e);return t.reduce(((e,t)=>e^t),0)}function T(){return n.Z.getFilledArrayBuffer(u,0)}function E(){const e=n.Z.setMagic(T(),m,v,d),t=new DataView(e);return t.setUint8(u-1,_(e)),e}function A(){const e=T(),t=new DataView(e);return t.setUint8(h,F),t.setUint16(f,D,s),t.setUint8(u-1,_(e)),e}function O(){const e=T(),t=new DataView(e);return t.setUint8(h+0,w),t.setUint8(h+1,w),t.setUint8(h+2,w),t.setUint8(h+3,w),t.setUint16(f,D,s),e}function B(e,t){return t.encode(e).slice(0,p)}function Z(e){const t=e.charAt(0);if("B"===t){const t=e.charAt(1);if("I"===t)return"Japan";if("A"===t)return"North America";if("E"===t)return"Europe"}return"Unknown region"}function L(e,t,a){const r=e.rawData.byteLength/o;let i=!1,n=0;r>=2&&(i=!0,n=r-2);const l=[];let c=t;{const t=T(),i=new Uint8Array(t),n=new DataView(t),o=B(e.filename,a);n.setUint8(h,C),n.setUint32(y,e.rawData.byteLength,s),n.setUint16(f,r>1?c+1:D,s),i.set(o,S),n.setUint8(u-1,_(t)),l.push(t)}for(let o=0;o<n;o+=1){c+=1;const e=T(),t=new DataView(e);t.setUint8(h,x),t.setUint16(f,c+1,s),t.setUint8(u-1,_(e)),l.push(e)}if(i){const e=T(),t=new DataView(e);t.setUint8(h,b),t.setUint16(f,D,s),t.setUint8(u-1,_(e)),l.push(e)}return l}class I{static getDirectoryFrame(e,t){return M(e,t)}static encodeFilename(e,t){return B(e,t)}static createHeaderBlock(e){const t=[],a=new TextEncoder(g);t.push(E()),e.forEach((e=>{const r=L(e,t.length-1,a);t.push(...r)}));while(t.length<c)t.push(A());while(t.length<o/u)t.push(O());return n.Z.concatArrayBuffers(t)}static readDirectoryBlock(e){n.Z.checkMagic(e,m,v,d);const t=new TextDecoder(g),a=[];for(let r=0;r<l;r+=1){let i=M(e,r),o=new DataView(i);const l=o.getUint8(h);if((240&l)!==F&&l!==w&&l===C){const l=n.Z.trimNull(t.decode(i.slice(S,S+p))),c=Z(l),u=o.getUint32(y,s),d=[r];let v=o.getUint16(f,s);while(v!==D)d.push(v),i=M(e,v),o=new DataView(i),v=o.getUint16(f,s);a.push({startingBlock:r,filename:l,regionName:c,dataBlockNumbers:d,rawDataSize:u})}}return a}}(0,r.Z)(I,"DIRECTORY_FRAME_AVAILABLE_OFFSET",h),(0,r.Z)(I,"DIRECTORY_FRAME_NEXT_BLOCK_OFFSET",f)},6393:function(e,t,a){a.d(t,{Z:function(){return C}});var r=a(8250),i=a(0),n=(a(7658),a(146));const{BLOCK_SIZE:s,NUM_DATA_BLOCKS:o,MAGIC_ENCODING:l}=r["default"],c="SC",u=0,d=4,v=64,m="shift-jis";function h(e,t){const a=s*t;return e.slice(a,a+s)}function f(){return n.Z.getFilledArrayBuffer(s,0)}function D(e){return e.replace(/[\uff01-\uff5e]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/\u3000/g," ")}class S{static checkMagic(e){n.Z.checkMagic(e,u,c,l)}static readSaveBlocks(e,t){const a=new TextDecoder(m),r=e.dataBlockNumbers.map((e=>h(t,e)));n.Z.checkMagic(r[0],u,c,l);const i=D(n.Z.trimNull(a.decode(r[0].slice(d,d+v)))),s=n.Z.concatArrayBuffers(r);if(s.byteLength!==e.rawDataSize)throw new Error(`Save file appears to be corrupted: expected file ${i} to be ${e.rawDataSize} bytes, but was actually ${s.byteLength} bytes`);return{...e,description:i,rawData:s}}static createSaveBlocks(e){const t=[];e.forEach((e=>{const a=e.rawData.byteLength/s;for(let r=0;r<a;r+=1)t.push(e.rawData.slice(r*s,(r+1)*s))}));while(t.length<o)t.push(f());return t}}const{BLOCK_SIZE:p,NUM_DATA_BLOCKS:g,NUM_TOTAL_BLOCKS:y}=r["default"];function F(e){if(S.checkMagic(e.rawData),e.rawData.byteLength<=0)throw new Error(`File ${e.filename} does not contain any data`);if(e.rawData.byteLength%p!==0)throw new Error(`File ${e.filename} size must be a multiple of ${p} bytes`)}class C{static encodeFilename(e,t){return i.Z.encodeFilename(e,t)}static createFromPs1MemcardData(e){return new C(e)}static createFromSaveFiles(e){e.forEach((e=>F(e)));const t=e.reduce(((e,t)=>e+t.rawData.byteLength),0);if(t>g*p)throw new Error(`Total size of files is ${t} bytes (${t/p} blocks) but max size is ${g*p} bytes (${g} blocks)`);const a=i.Z.createHeaderBlock(e),r=S.createSaveBlocks(e),s=n.Z.concatArrayBuffers([a,...r]);return new C(s)}constructor(e){this.arrayBuffer=e;const t=e.slice(0,p),a=e.slice(p,p*y),r=i.Z.readDirectoryBlock(t);this.saveFiles=r.map((e=>S.readSaveBlocks(e,a)))}getDirectoryFrame(e){const t=this.arrayBuffer.slice(0,p);return i.Z.getDirectoryFrame(t,e)}getSaveFiles(){return this.saveFiles}getArrayBuffer(){return this.arrayBuffer}}},6318:function(e,t,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function n(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)}function s(e,t,a){return t=n(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return s}})}}]);