"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[512],{2051:function(e,t,i){i.r(t),i.d(t,{default:function(){return Bi}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertDreamcast")],1)},r=[],n=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Raw/emulator")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{ref:"inputFileDreamcastSaveData",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.bin, *.vmu, *.flash)",leaveRoomForHelpIcon:!1,acceptExtension:".bin,.vmu,.flash"},on:{load:function(t){return e.readDreamcastSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.dreamcastSaveData,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.individualSavesOrSaveText))]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",["dci"===this.individualSaveType?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("output-filename",{attrs:{placeholder:"Output filename (.vmi)",leaveRoomForHelpIcon:!0,disabled:!1},model:{value:e.outputFilenameVmi,callback:function(t){e.outputFilenameVmi=t},expression:"outputFilenameVmi"}}),t("output-filename",{attrs:{placeholder:"Output filename (.vms)",leaveRoomForHelpIcon:!0,disabled:!1},model:{value:e.outputFilenameVms,callback:function(t){e.outputFilenameVms=t},expression:"outputFilenameVms"}})],1),t("dreamcast-individual-save-type-selector",{attrs:{value:this.individualSaveType},on:{change:function(t){return e.changeIndividualSaveType(t)}}})],1):t("div",["dci"===this.individualSaveType?t("div",[t("input-file",{ref:"inputFileIndividualSaveDci",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add (*.dci)",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0,acceptExtension:".dci"},on:{load:function(t){return e.readEmulatorSaveData(t)}}})],1):t("div",[t("input-file",{ref:"inputFileIndividualSaveVmi",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose file to add (*.vmi)",leaveRoomForHelpIcon:!1,allowMultipleFiles:!1,acceptExtension:".vmi"},on:{load:function(t){return e.readVmiSaveData(t)}}}),t("input-file",{ref:"inputFileIndividualSaveVms",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose file to add (*.vms)",leaveRoomForHelpIcon:!1,allowMultipleFiles:!1,acceptExtension:".vms"},on:{load:function(t){return e.readVmsSaveData(t)}}})],1),t("dreamcast-individual-save-type-selector",{attrs:{value:this.individualSaveType},on:{change:function(t){return e.changeIndividualSaveType(t)}}}),t("file-list",{attrs:{display:null!==this.dreamcastSaveData,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"dreamcast-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=dc"}},[e._v("copy save files to and from a Dreamcast console")]),e._v("? ")],1)])],1)],1)],1)},s=[],l=(i(7658),i(3162)),o=i(146),c=i(1203),u=i(3220),m=i(1758),f=i(4507),d=function(){var e=this,t=e._self._c;return t("b-form-group",{scopedSlots:e._u([{key:"default",fn:function({ariaDescribedby:i}){return[t("b-form-radio-group",{staticClass:"equal-width-radios w-100",attrs:{options:e.options,"aria-describedby":i,buttons:"","button-variant":"outline-info"},model:{value:e.valueLocal,callback:function(t){e.valueLocal=t},expression:"valueLocal"}})]}}])})},v=[],h={name:"DreamcastIndividualSaveTypeSelector",props:{value:{type:String,default:null}},model:{prop:"value",event:"change"},computed:{valueLocal:{get(){return this.value},set(e){this.$emit("change",e)}}},data(){return{options:[{value:"dci",text:".dci"},{value:"vmivms",text:".vmi/.vms"}]}}},S=h,p=i(1001),g=(0,p.Z)(S,d,v,!1,null,"5a6034d8",null),_=g.exports,E=i(1305),y=i(6318);class B{}(0,y.Z)(B,"LITTLE_ENDIAN",!0),(0,y.Z)(B,"WORD_SIZE_IN_BYTES",4),(0,y.Z)(B,"BLOCK_SIZE",512),(0,y.Z)(B,"NUM_BLOCKS",256),(0,y.Z)(B,"TOTAL_SIZE",B.BLOCK_SIZE*B.NUM_BLOCKS),(0,y.Z)(B,"SYSTEM_INFO_BLOCK_NUMBER",255),(0,y.Z)(B,"SYSTEM_INFO_SIZE_IN_BLOCKS",1),(0,y.Z)(B,"FILE_ALLOCATION_TABLE_BLOCK_NUMBER",254),(0,y.Z)(B,"FILE_ALLOCATION_TABLE_SIZE_IN_BLOCKS",1),(0,y.Z)(B,"DIRECTORY_BLOCK_NUMBER",253),(0,y.Z)(B,"DIRECTORY_SIZE_IN_BLOCKS",13),(0,y.Z)(B,"DIRECTORY_END_BLOCK_NUMBER",B.DIRECTORY_BLOCK_NUMBER-B.DIRECTORY_SIZE_IN_BLOCKS+1),(0,y.Z)(B,"EXTRA_AREA_BLOCK_NUMBER",B.DIRECTORY_BLOCK_NUMBER-B.DIRECTORY_SIZE_IN_BLOCKS),(0,y.Z)(B,"EXTRA_AREA_SIZE_IN_BLOCKS",41),(0,y.Z)(B,"SAVE_AREA_SIZE_IN_BLOCKS",200),(0,y.Z)(B,"SAVE_AREA_BLOCK_NUMBER",B.SAVE_AREA_SIZE_IN_BLOCKS-1),(0,y.Z)(B,"DEFAULT_GAME_BLOCK",0),(0,y.Z)(B,"DEFAULT_MAX_GAME_SIZE",128),(0,y.Z)(B,"MAX_NUM_GAMES",1),(0,y.Z)(B,"FILE_TYPE_DATA","Data"),(0,y.Z)(B,"FILE_TYPE_GAME","Game");i(3767),i(8585),i(8696);const{LITTLE_ENDIAN:I}=B,D=0,b=2,A=3,F=4,T=5,L=6,U=7,w=0,N=1,C=8;function O(e){const t=Math.floor(e/16),i=e%16;return 10*t+i}function Z(e){const t=Math.floor(e/10),i=e%10;return t<<4|i}function M(e){const t=e=>String(e).padStart(2,"0"),i=e.getFullYear(),a=t(e.getMonth()+1),r=t(e.getDate()),n=t(e.getHours()),s=t(e.getMinutes()),l=t(e.getSeconds());return`${i}-${a}-${r} ${n}:${s}:${l}`}class R{static readTimestamp(e,t){const i=new DataView(e.slice(t,t+C)),a=i.getUint16(D,I),r=i.getUint8(b)-1,n=i.getUint8(A),s=i.getUint8(F),l=i.getUint8(T),o=i.getUint8(L),c=new Date(a,r,n,s,l,o);return c}static writeTimestamp(e,t,i){const a=new ArrayBuffer(C),r=new DataView(a);return r.setUint16(D,i.getFullYear(),I),r.setUint8(b,i.getMonth()+1),r.setUint8(A,i.getDate()),r.setUint8(F,i.getHours()),r.setUint8(T,i.getMinutes()),r.setUint8(L,i.getSeconds()),r.setUint8(U,i.getDay()),o.Z.setArrayBufferPortion(e,a,t,0,C)}static readBcdTimestamp(e,t){const i=new DataView(e.slice(t,t+C)),a=O(i.getUint8(w)),r=O(i.getUint8(N)),n=100*a+r,s=O(i.getUint8(b))-1,l=O(i.getUint8(A)),o=O(i.getUint8(F)),c=O(i.getUint8(T)),u=O(i.getUint8(L)),m=new Date(n,s,l,o,c,u);return m}static writeBcdTimestamp(e,t,i){const a=new ArrayBuffer(C),r=new DataView(a),n=Math.floor(i.getFullYear()/100),s=i.getFullYear()%100;return r.setUint8(w,Z(n)),r.setUint8(N,Z(s)),r.setUint8(b,Z(i.getMonth()+1)),r.setUint8(A,Z(i.getDate())),r.setUint8(F,Z(i.getHours())),r.setUint8(T,Z(i.getMinutes())),r.setUint8(L,Z(i.getSeconds())),r.setUint8(U,Z(i.getDay())),o.Z.setArrayBufferPortion(e,a,t,0,C)}static formatDateWithoutTimezone(e){return M(e)}}const{LITTLE_ENDIAN:k}=B,V=0,K=16,$=85,x=new Uint8Array(o.Z.getFilledArrayBuffer(K,$)),Y=16,z=17,P=18,G=19,H=20,j=48,q=64,X=66,W=68,J=70,Q=72,ee=74,te=76,ie=78,ae=80,re=82,ne=84,se=86,le=0,oe=0;class ce{static writeSystemInfo(e){let t=o.Z.getFilledArrayBuffer(B.BLOCK_SIZE,oe);t=o.Z.setMagicBytes(t,V,x),t=R.writeBcdTimestamp(t,j,e.timestamp);const i=new DataView(t);return i.setUint8(Y,e.useCustomColor?1:0),Object.hasOwn(e,"customColor")?(i.setUint8(z,e.customColor.blue),i.setUint8(P,e.customColor.green),i.setUint8(G,e.customColor.red),i.setUint8(H,e.customColor.alpha)):(i.setUint8(z,0),i.setUint8(P,0),i.setUint8(G,0),i.setUint8(H,0)),i.setUint16(q,B.NUM_BLOCKS-1,k),i.setUint16(X,le,k),i.setUint16(W,B.SYSTEM_INFO_BLOCK_NUMBER,k),i.setUint16(J,B.FILE_ALLOCATION_TABLE_BLOCK_NUMBER,k),i.setUint16(Q,B.FILE_ALLOCATION_TABLE_SIZE_IN_BLOCKS,k),i.setUint16(ee,B.DIRECTORY_BLOCK_NUMBER,k),i.setUint16(te,B.DIRECTORY_SIZE_IN_BLOCKS,k),i.setUint8(ie,e.iconShape),i.setUint16(ae,B.SAVE_AREA_SIZE_IN_BLOCKS,k),i.setUint16(re,B.EXTRA_AREA_SIZE_IN_BLOCKS,k),i.setUint16(ne,B.DEFAULT_GAME_BLOCK,k),i.setUint16(se,B.DEFAULT_MAX_GAME_SIZE,k),t}static readSystemInfo(e){o.Z.checkMagicBytes(e,V,x);const t=new DataView(e),i=0!==t.getUint8(Y),a={blue:t.getUint8(z),green:t.getUint8(P),red:t.getUint8(G),alpha:t.getUint8(H)},r=R.readBcdTimestamp(e,j),n=t.getUint16(q,k),s=t.getUint16(X,k),l=t.getUint16(W,k),c=t.getUint16(J,k),u=t.getUint16(Q,k),m=t.getUint16(ee,k),f=t.getUint16(te,k),d=t.getUint8(ie),v=t.getUint16(ae,k),h=t.getUint16(re,k),S=t.getUint16(ne,k),p=t.getUint16(se,k);return{useCustomColor:i,customColor:a,timestamp:r,largestBlockNumber:n,partitionNumber:s,systemInfo:{blockNumber:l,sizeInBlocks:B.SYSTEM_INFO_SIZE_IN_BLOCKS},fileAllocationTable:{blockNumber:c,sizeInBlocks:u},directory:{blockNumber:m,sizeInBlocks:f},iconShape:d,extraArea:{blockNumber:B.EXTRA_AREA_BLOCK_NUMBER,sizeInBlocks:h},saveArea:{blockNumber:B.SAVE_AREA_BLOCK_NUMBER,sizeInBlocks:v},gameBlock:S,maxGameSize:p}}}const{LITTLE_ENDIAN:ue,BLOCK_SIZE:me,DEFAULT_GAME_BLOCK:fe,SAVE_AREA_BLOCK_NUMBER:de,SYSTEM_INFO_BLOCK_NUMBER:ve,FILE_ALLOCATION_TABLE_BLOCK_NUMBER:he,DIRECTORY_BLOCK_NUMBER:Se,DIRECTORY_SIZE_IN_BLOCKS:pe}=B,ge=65532,_e=65530,Ee=65535,ye=0;class Be{static writeFileAllocationTable(e,t){const i=o.Z.getFilledArrayBuffer(me,ye),a=new DataView(i);a.setUint16(2*ve,_e,ue),a.setUint16(2*he,_e,ue),a.setUint16(2*(Se-pe+1),_e,ue),E.Z.createReverseSequentialArray(Se,pe-1).forEach((e=>a.setUint16(2*e,e-1,ue)));let r=fe;e.forEach((e=>{E.Z.createSequentialArray(e.firstBlockNumber,e.fileSizeInBlocks-1).forEach((e=>a.setUint16(2*e,e+1,ue))),a.setUint16(2*(e.firstBlockNumber+e.fileSizeInBlocks-1),_e,ue),r=e.firstBlockNumber+e.fileSizeInBlocks}));let n=de;t.forEach((e=>{E.Z.createReverseSequentialArray(e.firstBlockNumber,e.fileSizeInBlocks-1).forEach((e=>a.setUint16(2*e,e-1,ue))),a.setUint16(2*(e.firstBlockNumber-e.fileSizeInBlocks+1),_e,ue),n=e.firstBlockNumber-e.fileSizeInBlocks}));const s=n-r+1;return E.Z.createReverseSequentialArray(n,s).forEach((e=>a.setUint16(2*e,ge,ue))),i}static readFileAllocationTable(e){const t=e.byteLength/2,i=new DataView(e),a=new Array(t);for(let r=0;r<t;r+=1){const e=2*r;if(a[r]=i.getUint16(e,ue),a[r]>=t&&a[r]!==ge&&a[r]!==_e&&a[r]!==Ee)throw new Error(`Found invalid value 0x${a[r].toString(16)} in file allocation table at offset ${e}`)}return a}}(0,y.Z)(Be,"UNALLOCATED_BLOCK",ge),(0,y.Z)(Be,"LAST_BLOCK_IN_FILE",_e),(0,y.Z)(Be,"BLOCK_PHYSICALLY_DAMAGED",Ee);const{LITTLE_ENDIAN:Ie,BLOCK_SIZE:De,FILE_TYPE_DATA:be,FILE_TYPE_GAME:Ae}=B,Fe=0,Te=1,Le=2,Ue=4,we=12,Ne="shift-jis",Ce=16,Oe=24,Ze=26,Me={0:"No file",51:be,204:Ae},Re="Unknown",ke=255,Ve=Object.keys(Me),Ke=0,$e=255,xe=0,Ye=32,ze="shift-jis",Pe=0,Ge=16,He=16,je=48;function qe(e){return Object.hasOwn(Me,e)?Me[e]:Re}function Xe(e){const t=Ve.find((t=>Me[t]===e));return void 0===t?ke:t}class We{static writeDirectoryEntry(e){let t=o.Z.getFilledArrayBuffer(Ye,xe);t=o.Z.setString(t,Ue,e.filename,Ne,we),t=R.writeBcdTimestamp(t,Ce,e.fileCreationTime);const i=new DataView(t);return i.setUint8(Fe,Xe(e.fileType)),i.setUint8(Te,e.copyProtected?$e:Ke),i.setUint16(Le,e.firstBlockNumber,Ie),i.setUint16(Oe,e.fileSizeInBlocks,Ie),i.setUint16(Ze,e.fileHeaderBlockNumber,Ie),t}static getComments(e,t){const i=t.slice(e*De,(e+1)*De),a=new Uint8Array(i);let r=a.findIndex((e=>e<32));r<0&&(r=a.length);const n=a.slice(0,r);return{storageComment:o.Z.readNullTerminatedString(n,Pe,ze,Ge),fileComment:o.Z.readNullTerminatedString(n,He,ze,je)}}static readDirectoryEntry(e){const t=new Uint8Array(e),i=new DataView(e),a=t.some((e=>e!==xe));if(!a)return null;const r=i.getUint8(Fe),n=qe(r),s=i.getUint8(Te)===$e,l=i.getUint16(Le,Ie),c=o.Z.readNullTerminatedString(t,Ue,Ne,we),u=R.readBcdTimestamp(e,Ce),m=i.getUint16(Oe,Ie),f=i.getUint16(Ze,Ie);return{fileType:n,copyProtected:s,firstBlockNumber:l,filename:c,fileCreationTime:u,fileSizeInBlocks:m,fileHeaderBlockNumber:f}}}(0,y.Z)(We,"LENGTH",Ye);const{BLOCK_SIZE:Je,DIRECTORY_SIZE_IN_BLOCKS:Qe,SAVE_AREA_SIZE_IN_BLOCKS:et}=B,tt=0,it=et,at=We.LENGTH;class rt{static writeDirectory(e){const t=e.map((e=>We.writeDirectoryEntry(e))),i=t.length*We.LENGTH,a=o.Z.getFilledArrayBuffer(Je*Qe-i,tt);return o.Z.concatArrayBuffers([...t,a])}static readDirectory(e){const t=E.Z.createSequentialArray(0,it).map((t=>{const i=e.slice(t*at,(t+1)*at);return We.readDirectoryEntry(i)})).filter((e=>null!==e));return t}}const{BLOCK_SIZE:nt,TOTAL_SIZE:st,MAX_DIRECTORY_ENTRIES:lt,DIRECTORY_END_BLOCK_NUMBER:ot,SAVE_AREA_BLOCK_NUMBER:ct,SAVE_AREA_SIZE_IN_BLOCKS:ut,SYSTEM_INFO_SIZE_IN_BLOCKS:mt,EXTRA_AREA_SIZE_IN_BLOCKS:ft,FILE_TYPE_GAME:dt,MAX_NUM_GAMES:vt,DEFAULT_GAME_BLOCK:ht}=B,St=0;function pt(e,t){const i=e.map((e=>t.slice(e*nt,(e+1)*nt)));return o.Z.concatArrayBuffers(i)}function gt(e,t,i){const a=E.Z.createReverseSequentialArray(e,t);return pt(a,i)}function _t(e,t,i){return i.slice(e*nt,(e+t)*nt)}function Et(e){const t=Math.ceil(e.byteLength/nt),i=E.Z.createSequentialArray(0,t).map((t=>e.slice(t*nt,(t+1)*nt)));if(i[i.length-1].byteLength<nt){const e=nt-i[i.length-1].byteLength;i[i.length-1]=o.Z.concatArrayBuffers([i[i.length-1],o.Z.getFilledArrayBuffer(e,St)])}return i}function yt(e){return Et(e).reverse()}function Bt(e,t){const i=[];let a=e.firstBlockNumber;do{if(a<0||a>=t.length)throw new Error(`Save file ${e.filename} appears to be corrupted: it references invalid block ${a}`);if(t[a]===Be.UNALLOCATED_BLOCK)throw new Error(`Save file ${e.filename} appears to be corrupted: save file appears to contain a block that is unallocated`);if(t[a]===Be.BLOCK_PHYSICALLY_DAMAGED)throw new Error(`Save file ${e.filename} appears to be corrupted: save file appears to contain a block that is physically damaged`);i.push(a),a=t[a]}while(a!==Be.LAST_BLOCK_IN_FILE);if(i.length!==e.fileSizeInBlocks)throw new Error(`Save file ${e.filename} appears to be corrupted: expected to find ${e.fileSizeInBlocks} blocks but instead found ${i.length} blocks when traversing file allocation table`);return i}function It(e,t){const i=Math.ceil(e.rawData.byteLength/nt);return{...e,firstBlockNumber:t,fileSizeInBlocks:i}}function Dt(e){let t=ht;return e.map((e=>{const i=It(e,t);return t+=i.fileSizeInBlocks,i}))}function bt(e){let t=ct;return e.map((e=>{const i=It(e,t);return t-=i.fileSizeInBlocks,i}))}function At(e,t){return e.reduce(((e,i)=>(t(i)?e[0].push(i):e[1].push(i),e)),[[],[]])}class Ft{static createFromDreamcastData(e){if(e.byteLength<st||e.byteLength%nt!==0)throw new Error("This does not appear to be a Dreamcast VMU image");const t=Math.floor(e.byteLength/nt)-1,i=ce.readSystemInfo(gt(t,mt,e)),a=i.directory.blockNumber===ot;let r=gt(i.fileAllocationTable.blockNumber,i.fileAllocationTable.sizeInBlocks,e),n=gt(i.directory.blockNumber,i.directory.sizeInBlocks,e);a&&(r=_t(i.fileAllocationTable.blockNumber,i.fileAllocationTable.sizeInBlocks,e),n=_t(i.directory.blockNumber,i.directory.sizeInBlocks,e));const s=Be.readFileAllocationTable(r),l=rt.readDirectory(n),o=l.map((t=>{const i=Bt(t,s),a=pt(i,e),r=We.getComments(t.fileHeaderBlockNumber,a);return{...t,...r,blockNumberList:i,rawData:a}}));return new Ft(e,o,i)}static createFromSaveFiles(e,t){if(e.length>lt)throw new Error(`Unable to fit ${e.length} saves into a single VMU image. Max is ${lt}`);const[i,a]=At(e,(e=>e.fileType===dt));if(i.length>vt)throw new Error(`Unable to fit ${i.length} games into a single VMU image. Max is ${vt}`);const r=Dt(i),n=bt(a),s=[...r,...n],l=s.reduce(((e,t)=>e+t.fileSizeInBlocks),0);if(l>ut)throw new Error(`Save files contain a total of ${l} blocks of data but a VMU image can only hold ${ut} blocks`);const c=ce.writeSystemInfo(t),u=Be.writeFileAllocationTable(r,n),m=rt.writeDirectory(s),f=yt(c),d=yt(u),v=yt(m),h=o.Z.getFilledArrayBuffer(ft*nt,St),S=i.map((e=>Et(e.rawData))).flat(),p=a.reverse().map((e=>yt(e.rawData))).flat(),g=f.length+d.length+v.length+ft+p.length+S.length,_=o.Z.getFilledArrayBuffer(st-nt*g,St),E=o.Z.concatArrayBuffers([...S,_,...p,h,...v,...d,...f]);return new Ft(E,e,t)}constructor(e,t,i){this.arrayBuffer=e,this.saveFiles=t,this.volumeInfo=i}getSaveFiles(){return this.saveFiles}getVolumeInfo(){return this.volumeInfo}getArrayBuffer(){return this.arrayBuffer}}var Tt=i(5756);const{BLOCK_SIZE:Lt,WORD_SIZE_IN_BYTES:Ut}=B,wt=We.LENGTH,Nt=0;class Ct{static convertSaveFileToDci(e){const t={...e,firstBlockNumber:Nt,fileSizeInBlocks:Math.ceil(e.rawData.byteLength/Lt)},i=We.writeDirectoryEntry(t);return o.Z.concatArrayBuffers([i,Tt.Z.swap(t.rawData,Ut)])}static convertIndividualSaveToSaveFile(e,t=!1){const i=We.readDirectoryEntry(e),a=Tt.Z.swap(e.slice(wt),Ut);if(t&&a.byteLength!==i.fileSizeInBlocks*Lt)throw new Error("This file appears to be corrupt");const r=We.getComments(i.fileHeaderBlockNumber,a);return{...i,...r,rawData:a}}}const{LITTLE_ENDIAN:Ot,BLOCK_SIZE:Zt,FILE_TYPE_DATA:Mt,FILE_TYPE_GAME:Rt}=B,kt="shift-jis",Vt=108,Kt=0,$t=!1,xt="SEGA",Yt=4,zt=32,Pt=36,Gt=32,Ht=68,jt=76,qt=78,Xt=80,Wt=8,Jt=88,Qt=12,ei=100,ti=104,ii=2,ai=1,ri=0,ni=0,si=0,li=1,oi=0,ci=0,ui=1;function mi(e){let t=0,i=0;do{t<<=8,t|=e.charCodeAt(i)&xt.charCodeAt(i),i+=1}while(i<xt.length);return t}class fi{static convertSaveFileToVmiVms(e){let t=o.Z.getFilledArrayBuffer(Vt,ni);const i=e.rawData;t=o.Z.setString(t,Yt,e.description,kt,zt),t=o.Z.setString(t,Pt,e.copyright,kt,Gt),t=o.Z.setString(t,Xt,e.resourceName,kt,Wt),t=o.Z.setString(t,Jt,e.filename,kt,Qt),t=R.writeTimestamp(t,Ht,e.fileCreationTime);const a=new DataView(t),r=mi(e.resourceName);let n=0;return e.copyProtected&&(n|=ai),e.fileType===Rt&&(n|=ii),a.setUint32(Kt,r,$t),a.setUint16(jt,si,Ot),a.setUint16(qt,li,Ot),a.setUint16(ei,n,Ot),a.setUint32(ti,i.byteLength,Ot),{vmiArrayBuffer:t,vmsArrayBuffer:i}}static convertIndividualSaveToSaveFile(e,t){if(e.byteLength!==Vt)throw new Error("This does not appear to be a Dreamcast individual save: header is the wrong size");const i=new DataView(e),a=new Uint8Array(e),r=i.getUint32(Kt,$t),n=o.Z.readNullTerminatedString(a,Yt,kt,zt),s=o.Z.readNullTerminatedString(a,Pt,kt,Gt),l=R.readTimestamp(e,Ht),c=i.getUint16(jt,Ot),u=i.getUint16(qt,Ot),m=o.Z.readNullTerminatedString(a,Xt,kt,Wt),f=o.Z.readNullTerminatedString(a,Jt,kt,Qt),d=i.getUint16(ei,Ot),v=i.getUint32(ti,Ot);if(v!==t.byteLength)throw new Error(`This does not appear to be a Dreamcast individual save: file size in header ${v} does not match .VMS file size ${t.byteLength}`);const h=0!==(d&ii),S=Math.ceil(v/Zt),p=oi,g=h?Rt:Mt,_=0!==(d&ai),E=h?ui:ci,y=We.getComments(E,t);return{checksum:r,description:n,copyright:s,version:c,fileNumber:u,resourceName:m,fileMode:d,fileSize:v,filename:f,fileType:g,fileCreationTime:l,copyProtected:_,fileSizeInBlocks:S,firstBlockNumber:p,fileHeaderBlockNumber:E,...y,rawData:t}}}(0,y.Z)(fi,"FILE_MODE_GAME",ii),(0,y.Z)(fi,"FILE_MODE_COPY_PROTECTED",ai),(0,y.Z)(fi,"FILE_MODE_NONE",ri);const di=0,vi="dci";var hi={name:"ConvertDreamcast",data(){return{dreamcastSaveData:null,errorMessage:null,inputFilename:null,outputFilename:null,outputFilenameVmi:null,outputFilenameVms:null,conversionDirection:"convertToRaw",selectedSaveData:null,individualSaveType:vi,vmiVmsParts:{}}},components:{ConversionDirection:m.Z,InputFile:c.Z,OutputFilename:u.Z,FileList:f.Z,DreamcastIndividualSaveTypeSelector:_},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData;let t=!1;return t="convertToRaw"===this.conversionDirection?"dci"===this.individualSaveType&&null!==this.outputFilename||"dci"!==this.individualSaveType&&null!==this.outputFilenameVmi&&null!==this.outputFilenameVms:null!==this.outputFilename,!this.dreamcastSaveData||0===this.dreamcastSaveData.getSaveFiles().length||!e||!t},individualSavesOrSaveText(){return"vmivms"===this.individualSaveType&&"convertToFormat"===this.conversionDirection?"Individual save":"Individual saves"}},methods:{changeIndividualSaveType(e){this.individualSaveType!==e&&(this.individualSaveType=e,this.outputFilename=null,this.outputFilenameVmi=null,this.outputFilenameVms=null,this.vmiVmsParts={},"convertToFormat"===this.conversionDirection&&(this.dreamcastSaveData=null),this.$refs.inputFileIndividualSaveDci&&this.$refs.inputFileIndividualSaveDci.reset(),this.$refs.inputFileIndividualSaveVmi&&this.$refs.inputFileIndividualSaveVmi.reset(),this.$refs.inputFileIndividualSaveVms&&this.$refs.inputFileIndividualSaveVms.reset(),this.changeSelectedSaveData(this.selectedSaveData))},getFileNameFromSaveFile(e){return o.Z.convertDescriptionToFilename(`${e.filename}`)},getFileListNames(){return null!==this.dreamcastSaveData&&null!==this.dreamcastSaveData.getSaveFiles()?this.dreamcastSaveData.getSaveFiles().map((e=>{const t=e.fileType===B.FILE_TYPE_GAME?"Game: ":"",i=e.storageComment.trim(),a=e.fileComment.trim();return i.length>0&&a.length>0?{displayText:`${t}${i} - ${a}`}:i.length>0?{displayText:`${t}${i}`}:a.length>0?{displayText:`${t}${a}`}:{displayText:`${t}${e.filename}`}})):[]},changeConversionDirection(e){this.conversionDirection=e,this.dreamcastSaveData=null,this.errorMessage=null,this.inputFilename=null,this.outputFilename=null,this.outputFilenameVmi=null,this.outputFilenameVms=null,this.selectedSaveData=null,this.individualSaveType=vi,this.vmiVmsParts={},this.$refs.inputFileDreamcastSaveData&&this.$refs.inputFileDreamcastSaveData.reset(),this.$refs.inputFileIndividualSaveDci&&this.$refs.inputFileIndividualSaveDci.reset(),this.$refs.inputFileIndividualSaveVmi&&this.$refs.inputFileIndividualSaveVmi.reset(),this.$refs.inputFileIndividualSaveVms&&this.$refs.inputFileIndividualSaveVms.reset()},changeSelectedSaveData(e){if(null!==e)if(null!==this.dreamcastSaveData&&this.dreamcastSaveData.getSaveFiles().length>0){this.selectedSaveData=e;const t=this.getFileNameFromSaveFile(this.dreamcastSaveData.getSaveFiles()[this.selectedSaveData]);"dci"===this.individualSaveType?this.outputFilename=`${t}.dci`:(this.outputFilenameVmi=`${t}.vmi`,this.outputFilenameVms=`${t}.vms`)}else this.selectedSaveData=null,this.outputFilename=null,this.outputFilenameVmi=null,this.outputFilenameVms=null},readDreamcastSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.outputFilename=null,this.outputFilenameVmi=null,this.outputFilenameVms=null,this.inputFilename=e.filename;try{this.dreamcastSaveData=Ft.createFromDreamcastData(e.arrayBuffer)}catch(t){this.errorMessage="File appears to not be in the correct format",this.dreamcastSaveData=null,this.selectedSaveData=null}},readVmiSaveData(e){this.vmiVmsParts.vmiArrayBuffer=e.arrayBuffer,Object.hasOwn(this.vmiVmsParts,"vmiArrayBuffer")&&Object.hasOwn(this.vmiVmsParts,"vmsArrayBuffer")&&this.readEmulatorSaveData(null)},readVmsSaveData(e){this.vmiVmsParts.vmsArrayBuffer=e.arrayBuffer,Object.hasOwn(this.vmiVmsParts,"vmiArrayBuffer")&&Object.hasOwn(this.vmiVmsParts,"vmsArrayBuffer")&&this.readEmulatorSaveData(null)},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=null;try{let t=[];if("dci"===this.individualSaveType){const i=e.map((e=>e.arrayBuffer));t=i.map((e=>Ct.convertIndividualSaveToSaveFile(e)))}else t=[fi.convertIndividualSaveToSaveFile(this.vmiVmsParts.vmiArrayBuffer,this.vmiVmsParts.vmsArrayBuffer)];const i={useCustomColor:!1,timestamp:new Date,iconShape:di};this.dreamcastSaveData=Ft.createFromSaveFiles(t,i),this.dreamcastSaveData.getSaveFiles().length>0?this.outputFilename=`${this.getFileNameFromSaveFile(this.dreamcastSaveData.getSaveFiles()[0])}.bin`:this.outputFilename="output.bin"}catch(t){this.errorMessage=t.message,this.dreamcastSaveData=null,this.selectedSaveData=null,this.outputFilename=null,this.outputFilenameVmi=null,this.outputFilenameVms=null}},convertFile(){const e=[];if("convertToRaw"===this.conversionDirection){const t=this.dreamcastSaveData.getSaveFiles()[this.selectedSaveData];if("dci"===this.individualSaveType)e.push({arrayBuffer:Ct.convertSaveFileToDci(t),filename:this.outputFilename});else{const i={...t,description:"Created by savefileconverter.com",copyright:"savefileconverter.com",resourceName:t.filename},{vmiArrayBuffer:a,vmsArrayBuffer:r}=fi.convertSaveFileToVmiVms(i);e.push({arrayBuffer:a,filename:this.outputFilenameVmi},{arrayBuffer:r,filename:this.outputFilenameVms})}}else e.push({arrayBuffer:this.dreamcastSaveData.getArrayBuffer(),filename:this.outputFilename});e.forEach((e=>{const t=new Blob([e.arrayBuffer],{type:"application/octet-stream"});(0,l.saveAs)(t,e.filename)}))}}},Si=hi,pi=(0,p.Z)(Si,n,s,!1,null,"755ca342",null),gi=pi.exports,_i={name:"DreamcastView",components:{ConvertDreamcast:gi}},Ei=_i,yi=(0,p.Z)(Ei,a,r,!1,null,null,null),Bi=yi.exports},1305:function(e,t,i){i.d(t,{Z:function(){return a}});class a{static arraysEqual(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i+=1)if(e[i]!==t[i])return!1;return!0}static createSequentialArray(e,t){return Array(t).fill().map(((t,i)=>i+e))}static createReverseSequentialArray(e,t){return a.createSequentialArray(e-t+1,t).reverse()}}},5756:function(e,t,i){function a(e,t){for(let i=0;i<e.byteLength/2;i+=1){const a=e.getUint16(2*i,!0);t.setUint16(2*i,a,!1)}}function r(e,t){for(let i=0;i<e.byteLength/4;i+=1){const a=e.getUint32(4*i,!0);t.setUint32(4*i,a,!1)}}function n(e,t){for(let i=0;i<e.byteLength/8;i+=1){const a=e.getBigUint64(8*i,!0);t.setBigUint64(8*i,a,!1)}}i.d(t,{Z:function(){return l}});const s={2:a,4:r,8:n};class l{static swap(e,t){if(e.byteLength%t!==0)throw new Error(`File length must be a multiple of ${t} bytes`);if(!(t in s))throw new Error(`Word size must be one of ${Object.keys(s).join(", ")}`);const i=new ArrayBuffer(e.byteLength),a=new DataView(e),r=new DataView(i);return s[t](a,r),i}}},6318:function(e,t,i){function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(e,t){if("object"!==a(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function n(e){var t=r(e,"string");return"symbol"===a(t)?t:String(t)}function s(e,t,i){return t=n(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:function(){return s}})}}]);