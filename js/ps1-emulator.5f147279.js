"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[871],{8858:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertPs1Emulator")],1)},n=[],i=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Raw/emulator")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.mcr)",acceptExtension:".mcr",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readMemcardSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.memcardSaveData,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Individual saves")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!0,helpText:"The filename for an individual save contains important information that the game needs to find this save data. Please do not modify it after downloading the save."},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0},on:{load:function(t){return e.readEmulatorSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.memcardSaveData,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"ps1-emulator-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=ps1"}},[e._v("copy save files to and from a PS1 memory card")]),e._v("? ")],1)])],1)],1)],1)},s=[],o=a(3162),l=a(146),c=a(1203),u=a(3220),m=a(1758),f=a(4507),d=a(6393),h={name:"ConvertPs1Emulator",data(){return{memcardSaveData:null,errorMessage:null,outputFilename:null,conversionDirection:"convertToRaw",selectedSaveData:null}},components:{ConversionDirection:m.Z,InputFile:c.Z,OutputFilename:u.Z,FileList:f.Z},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData;return!this.memcardSaveData||0===this.memcardSaveData.getSaveFiles().length||!e||!this.outputFilename}},methods:{getFileListNames(){return null!==this.memcardSaveData&&null!==this.memcardSaveData.getSaveFiles()?this.memcardSaveData.getSaveFiles().map((e=>({displayText:`${e.description} (${e.regionName})`}))):[]},changeConversionDirection(e){this.conversionDirection=e,this.memcardSaveData=null,this.errorMessage=null,this.outputFilename=null,this.selectedSaveData=null},changeSelectedSaveData(e){this.memcardSaveData.getSaveFiles().length>0?(this.selectedSaveData=e,this.outputFilename=this.memcardSaveData.getSaveFiles()[this.selectedSaveData].filename):(this.selectedSaveData=null,this.outputFilename=null)},readMemcardSaveData(e){this.errorMessage=null,this.selectedSaveData=null;try{this.memcardSaveData=d.Z.createFromPs1MemcardData(e.arrayBuffer),this.changeSelectedSaveData(0)}catch(t){this.errorMessage="File appears to not be in the correct format",this.memcardSaveData=null,this.selectedSaveData=null}},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null;try{const t=e.map((e=>({filename:e.filename,rawData:e.arrayBuffer})));this.memcardSaveData=d.Z.createFromSaveFiles(t),this.memcardSaveData.getSaveFiles().length>0?this.outputFilename=`${l.Z.convertDescriptionToFilename(this.memcardSaveData.getSaveFiles()[0].description)}.mcr`:this.outputFilename="output.mcr"}catch(t){this.errorMessage=t.message,this.memcardSaveData=null,this.selectedSaveData=null}},convertFile(){const e="convertToRaw"===this.conversionDirection?this.memcardSaveData.getSaveFiles()[this.selectedSaveData].rawData:this.memcardSaveData.getArrayBuffer(),t=new Blob([e],{type:"application/octet-stream"});(0,o.saveAs)(t,this.outputFilename)}}},v=h,S=a(1001),D=(0,S.Z)(v,i,s,!1,null,"17176987",null),p=D.exports,g={name:"Ps1EmulatorView",components:{ConvertPs1Emulator:p}},w=g,b=(0,S.Z)(w,r,n,!1,null,null,null),y=b.exports},8250:function(e,t,a){a.d(t,{default:function(){return n}});var r=a(6318);class n{}(0,r.Z)(n,"NUM_RESERVED_BLOCKS",1),(0,r.Z)(n,"NUM_DATA_BLOCKS",15),(0,r.Z)(n,"NUM_TOTAL_BLOCKS",n.NUM_RESERVED_BLOCKS+n.NUM_DATA_BLOCKS),(0,r.Z)(n,"BLOCK_SIZE",8192),(0,r.Z)(n,"FRAME_SIZE",128),(0,r.Z)(n,"TOTAL_SIZE",n.NUM_TOTAL_BLOCKS*n.BLOCK_SIZE),(0,r.Z)(n,"LITTLE_ENDIAN",!0),(0,r.Z)(n,"MAGIC_ENCODING","US-ASCII")},0:function(e,t,a){a.d(t,{Z:function(){return N}});var r=a(6318),n=(a(3767),a(8585),a(8696),a(7658),a(8250)),i=a(146);const{LITTLE_ENDIAN:s,BLOCK_SIZE:o,NUM_DATA_BLOCKS:l,NUM_TOTAL_BLOCKS:c,FRAME_SIZE:u,MAGIC_ENCODING:m}=n["default"],f="MC",d=0,h=0,v=8,S=65535,D=10,p=20,g="US-ASCII",w=4,b=160,y=81,F=82,_=83,E=255;function C(e,t){const a=u+t*u;return e.slice(a,a+u)}function B(e){const t=new Uint8Array(e);return t.reduce(((e,t)=>e^t),0)}function Z(){return i.Z.getFilledArrayBuffer(u,0)}function A(){const e=i.Z.setMagic(Z(),d,f,m),t=new DataView(e);return t.setUint8(u-1,B(e)),e}function L(){const e=Z(),t=new DataView(e);return t.setUint8(h,b),t.setUint16(v,S,s),t.setUint8(u-1,B(e)),e}function M(){const e=Z(),t=new DataView(e);return t.setUint8(h+0,E),t.setUint8(h+1,E),t.setUint8(h+2,E),t.setUint8(h+3,E),t.setUint16(v,S,s),e}function T(e,t){return t.encode(e).slice(0,p)}function U(e){const t=e.charAt(0);if("B"===t){const t=e.charAt(1);if("I"===t)return"Japan";if("A"===t)return"North America";if("E"===t)return"Europe"}return"Unknown region"}function I(e,t,a){const r=e.rawData.byteLength/o;let n=!1,i=0;r>=2&&(n=!0,i=r-2);const l=[];let c=t;{const t=Z(),n=new Uint8Array(t),i=new DataView(t),o=T(e.filename,a);i.setUint8(h,y),i.setUint32(w,e.rawData.byteLength,s),i.setUint16(v,r>1?c+1:S,s),n.set(o,D),i.setUint8(u-1,B(t)),l.push(t)}for(let o=0;o<i;o+=1){c+=1;const e=Z(),t=new DataView(e);t.setUint8(h,F),t.setUint16(v,c+1,s),t.setUint8(u-1,B(e)),l.push(e)}if(n){const e=Z(),t=new DataView(e);t.setUint8(h,_),t.setUint16(v,S,s),t.setUint8(u-1,B(e)),l.push(e)}return l}class N{static getDirectoryFrame(e,t){return C(e,t)}static encodeFilename(e,t){return T(e,t)}static createHeaderBlock(e){const t=[],a=new TextEncoder(g);t.push(A()),e.forEach((e=>{const r=I(e,t.length-1,a);t.push(...r)}));while(t.length<c)t.push(L());while(t.length<o/u)t.push(M());return i.Z.concatArrayBuffers(t)}static readDirectoryBlock(e){i.Z.checkMagic(e,d,f,m);const t=new TextDecoder(g),a=[];for(let r=0;r<l;r+=1){let n=C(e,r),o=new DataView(n);const l=o.getUint8(h);if((240&l)!==b&&l!==E&&l===y){const l=i.Z.trimNull(t.decode(n.slice(D,D+p))),c=U(l),u=o.getUint32(w,s),m=[r];let f=o.getUint16(v,s);while(f!==S)m.push(f),n=C(e,f),o=new DataView(n),f=o.getUint16(v,s);a.push({startingBlock:r,filename:l,regionName:c,dataBlockNumbers:m,rawDataSize:u})}}return a}}(0,r.Z)(N,"DIRECTORY_FRAME_AVAILABLE_OFFSET",h),(0,r.Z)(N,"DIRECTORY_FRAME_NEXT_BLOCK_OFFSET",v)},6393:function(e,t,a){a.d(t,{Z:function(){return y}});var r=a(8250),n=a(0),i=(a(7658),a(146));const{BLOCK_SIZE:s,NUM_DATA_BLOCKS:o,MAGIC_ENCODING:l}=r["default"],c="SC",u=0,m=4,f=64,d="shift-jis";function h(e,t){const a=s*t;return e.slice(a,a+s)}function v(){return i.Z.getFilledArrayBuffer(s,0)}function S(e){return e.replace(/[\uff01-\uff5e]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/\u3000/g," ")}class D{static checkMagic(e){i.Z.checkMagic(e,u,c,l)}static readSaveBlocks(e,t){const a=new TextDecoder(d),r=e.dataBlockNumbers.map((e=>h(t,e)));i.Z.checkMagic(r[0],u,c,l);const n=S(i.Z.trimNull(a.decode(r[0].slice(m,m+f)))),s=i.Z.concatArrayBuffers(r);if(s.byteLength!==e.rawDataSize)throw new Error(`Save file appears to be corrupted: expected file ${n} to be ${e.rawDataSize} bytes, but was actually ${s.byteLength} bytes`);return{...e,description:n,rawData:s}}static createSaveBlocks(e){const t=[];e.forEach((e=>{const a=e.rawData.byteLength/s;for(let r=0;r<a;r+=1)t.push(e.rawData.slice(r*s,(r+1)*s))}));while(t.length<o)t.push(v());return t}}const{BLOCK_SIZE:p,NUM_DATA_BLOCKS:g,NUM_TOTAL_BLOCKS:w}=r["default"];function b(e){if(D.checkMagic(e.rawData),e.rawData.byteLength<=0)throw new Error(`File ${e.filename} does not contain any data`);if(e.rawData.byteLength%p!==0)throw new Error(`File ${e.filename} size must be a multiple of ${p} bytes`)}class y{static encodeFilename(e,t){return n.Z.encodeFilename(e,t)}static createFromPs1MemcardData(e){return new y(e)}static createFromSaveFiles(e){e.forEach((e=>b(e)));const t=e.reduce(((e,t)=>e+t.rawData.byteLength),0);if(t>g*p)throw new Error(`Total size of files is ${t} bytes (${t/p} blocks) but max size is ${g*p} bytes (${g} blocks)`);const a=n.Z.createHeaderBlock(e),r=D.createSaveBlocks(e),s=i.Z.concatArrayBuffers([a,...r]);return new y(s)}constructor(e){this.arrayBuffer=e;const t=e.slice(0,p),a=e.slice(p,p*w),r=n.Z.readDirectoryBlock(t);this.saveFiles=r.map((e=>D.readSaveBlocks(e,a)))}getDirectoryFrame(e){const t=this.arrayBuffer.slice(0,p);return n.Z.getDirectoryFrame(t,e)}getSaveFiles(){return this.saveFiles}getArrayBuffer(){return this.arrayBuffer}}},6318:function(e,t,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=n(e,"string");return"symbol"===r(t)?t:String(t)}function s(e,t,a){return t=i(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return s}})}}]);